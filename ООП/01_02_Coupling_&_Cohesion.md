# Зависимость и Сплоченность (Coupling & Cohesion)

В программировании есть много принципов, они решают определенные проблемы, но все они введут к  одной цели — создание гибкой системы, которую можно легко расширять и повторно использовать. И прежде чем разбираться с конкретными проблемами, сначала стоит понять общую картину.

Под общей картиной будет подразумеваться — создание гибкой и расширяемой системой. 

Итак, качественный дизайн должен обладать ***слабой зависимостью*** (low coupling) и ***сильной сплоченностью*** (hight cohesion).

![](https://devopedia.org/images/article/265/1220.1585331357.png)



> ***Компоненты*** — это единицы развертывания. Они представляют наименьшие сущности, которые можно развертывать в составе системы. В Java — это jar-файлы. В Ruby — gem-файлы. В .Net — библиотеки DLL.
>
> — Роберт Мартин (Чистая Архитектура)

***Зависимость (coupling)*** — это уровень взаимосвязи между компонентами.

***Слабая зависимость*** означает, что компоненты должны иметь как можно меньше связей между друг другом и быть максимально автономными. Это позволит использовать компонент в другом приложении.

***Сильная зависимость*** затрудняет понимание логики компонентов, затрудняет любую модификацию компонента и его тестирование, усложняет использовать компоненты по отдельности.

Критерии слабой зависимости:

1. Малое число зависимостей между компонентами.
2. Изменение одного компонента не влечёт за собой изменение поведения другого.
3. Высокая степень повторного использования компонентов.

Критерии сильной зависимости:

1. Большое число зависимостей между компонентами.
2. Изменения одного компоненты влечет за собой изменения другого или появление в нем ошибок.
3. Компоненты сложно отделить друг от друга и использовать по отдельности.

***Сплоченность (cohesion)*** — это уровень направленность элементов компонента на решения определенной задачи или задач похожих по смыслу.

***Сильная сплоченность*** означает, что компонент должен быть направлен на решения определенной задачи. Если компонент отвечает за работу с базой данных он не должен решать задачи графического интерфейса.

***Слабая сплоченность*** — компонент выполняет много разнородных функций и несвязных между собой обязанностей.

Критерии слабой сплоченности:

1. Компонент решает разные по смыслу задачи.
2. Сложно понять, чем именно занимается компонент и какие задачи решает.
3. Компонент может иметь множество причин для изменений, а именно решать разные задачи.
4. Компонент постоянно подвержен изменениям.
5. Компонент сложно поддерживать и использовать отдельно.

Критерии сильной сплоченности:

1. Компонент решает близкие по смыслу задачи.
2. Легко понять, что именно делает компонент.
3. Компонент имеет только одну причину для изменений, а именно решать определенную задачу или похожие задачи.
4. Компонент легко поддерживать и повторно использовать.

Чем больше проблем разного характера решает один компонент, тем больше зависимостей он включает в себя. Один компонент не должен знать слишком много о других. Для этого между компонентами лучше использовать интерфейсы, чтобы избежать зависимости от реализации. Продуманный интерфейс описывает чем именно занимается компонент и какие задачи решает. Хорошей практикой проектировать систему начиная с интерфейсов, а потом спускаться на более низкие уровни - конкретную реализацию.

## Пример из реальной жизни

Пример на человеческом организме: ***организм*** (приложение) состоит ***органов*** (объектов), которые образуют ***системы органов*** (компоненты).

![](https://cdn.shortpixel.ai/client/q_glossy,ret_img,w_550,h_270/http://xn--80aexocohdp.xn--p1ai/wp-content/uploads/25-interesnih-faktov-o-krovenosnoy-sisteme-cheloveka-e1540380733557.jpg)

В организме одна ***система органов (компонент)*** решает ***схожие задачи***. К примеру кровеносная система обеспечивает постоянную циркуляцию крови по замкнутой системе сосудов. Пищеварительная система осуществляет переваривание пищи и выведение непереваренных остатков продуктов.

***Органы (объекты)*** решают ***определенную задачу***. К примеру сердце перекачивает кровь, а кровеносные каналы выполняют функцию проводника, по которым она течёт. Сердце тоже можно назвать проводником крови, но главная его задача перекачивать кровь, в то время как задача кровеносных каналов быть только проводником.

***Органы (объекты)*** выполняют ***определённую задачу***, а вот ***системы органов  (компоненты)*** выполняют ***схожие задачи***.

У систем органов есть интерфейс взаимодействия между собой, с минимальной зависимостью. Некоторые органы не взаимодействуют с другими напрямую. К примеру сердце взаимодействует с лёгкими через кровеносные каналы. Сердцу всё ровно как работают лёгкие, а лёгким как работает сердце. Они даже могут не знать друг о друге. Лёгкие передают кислород по кровеносным сосудам, сердце перекачивает кровь и по сосудам другие органы получают необходимые им элементы, или передают их обратно.

В данном примере главное, что органы взаимодействуют между собой с минимальной зависимостью и решают схожие задачи по смыслу. Сердце не занимается перевариванием пищи, а пищеварительная система не качает кровь. 

Взаимодействие пищеварительной системы, сердца и лёгких можно представить как разделенные слои взаимодействия. Пищеварительная система и лёгкие взаимодействуют между собой через сердце.

# Закон Деметры

Закон Деметры — это набор правил при разработке программного обеспечения. Закон накладывает ограничения на взаимодействия между компонентами.

Закон диметры является примером ***слабой зависимости*** между компонентами программы.

> Компонент А не может обращаться к компоненту С, если компонент А имеет доступ к компоненту В, который имеет доступ к компонентам А и С.

![Закон Деметры](https://i.imgur.com/ftD6z6u.png)





К примеру нужно обратиться к человеку за помощью, но вы не знаете его. Однако у вас есть общий друг. Соответственно вы обратитесь к вашему общему другу, чтобы он попросил этого человека что-то сделать.

> Друг вашего друга, для вас - незнакомец.

Хорошим примером закона Диметры является архитектурный шаблон ***Model-View-Controller (MVC)***.  Так как в данном шаблоне Модель и Представление общаются между собой через Контроллер и не имеют прямого доступа к друг другу.

# Источники

1. [Low Coupling и High Cohesion - Medium](https://medium.com/german-gorelkin/low-coupling-high-cohesion-d36369fb1be9)
2. [Clean Architecture - Robert C. Martin](https://www.amazon.co.uk/Clean-Architecture-Craftsmans-Software-Structure/dp/0134494164)